(function(b,c){var d=function(){var t=null;var p="";var y=b("#cptx_check");var x="";var s="";var q="";var A="";var w="";var v="";var m=b("#fontlist");var H=[];var r="";var F={autoOpen:false,title:"CPROTEXT",resizable:false,modal:true};function z(){var i=b("#cptxoptionsave");if(i.attr("disabled")==="disabled"){i.removeAttr("disabled")}}function f(){r.dialog("close");r.remove();r=""}function n(i,I){b("#cptx_optionform").ajaxForm({beforeSerialize:function(K,J){var L={f:"font",t:i,};L[cprotext.API.NONCE_VAR]=I;L=b.param(L);J.url=cprotext.API.URL+L;J.type="post";K[0].enctype="multipart/form-data";b(K[0]).find("input,select,button").attr("disabled","disabled");b(K[0].fontFile).removeAttr("disabled")},beforeSend:function(){var J=b(".progress");J.css("display","inline-block");var K=0;J.children(".bar").width(K);J.children(".percent").html(K+"%")},uploadProgress:function(N,M,L,K){var J=b(".progress");var O=K+"%";J.children(".bar").width(O);J.children(".percent").html(O)},success:function(){var J=b(".progress");var K="100%";J.children(".bar").width(K);J.children(".percent").html(K)},complete:function(O){b("#cptx_optionform *").removeAttr("disabled");var K=b.parseJSON(O.responseText);if(K.hasOwnProperty("error")){b(".status").html(K.error);return}b(".status").html(cprotext.L10N.fontfile1+" '"+K.data[1]+"' "+cprotext.L10N.fontfile2);b("#fontFile").val("");b("#cptx_fontsel").append("<option value='"+K.data[0]+"'>"+K.data[1]+"</option>");var L=b("#cptx_fontsel option");if(b(L[0]).attr("title")){b("#cptx_fontsel").empty()}var M=[];M.push("[");var N,J;for(N=0,J=L.length;N<J;N++){M.push('["'+b(L[N]).val()+'","'+b(L[N]).html()+'"]');M.push(",")}M.pop();M.push("]");b("#cptx_fontupd").val("1");b("#cptx_fonts").val(M.join(""))}});r.dialog("close");b("#cptx_optionform").submit();b("#cptx_optionform").ajaxFormUnbind()}function k(I,K){var J={f:"fonts",t:I};J[cprotext.API.NONCE_VAR]=K;J=b.param(J);var i=b.ajax({url:cprotext.API.URL,data:J,dataType:"jsonp",error:function(L,N,M){r.children("#cptx_msg").html(cprotext.L10N.fontlistFail+":<br/>"+N+"/"+M)},success:function(M){if(M.hasOwnProperty("error")){r.children("#cptx_msg").html(cprotext.L10N.fontlistFail+":<br/>"+M.error)}else{var O=[];O.push("[");b("#cptx_fontsel").empty();for(var N=0,L=M.fontlist.length;N<L;N++){b("#cptx_fontsel").append("<option value='"+M.fontlist[N][0]+"'>"+M.fontlist[N][1]+"</option>");O.push('["'+M.fontlist[N][0]+'","'+M.fontlist[N][1]+'"]');O.push(",")}O.pop();O.push("]");b("#cptx_fontsel").removeAttr("disabled");b("#cptx_fontupd").val("1");b("#cptx_fonts").val(O.join(""));z()}f()}})}function o(I,K,L){b(".ui-dialog-buttonpane").attr("disabled","disabled").css("visibility","hidden");b(".legen p").html(cprotext.L10N.getInit);var J={f:"get",t:I,tid:L};J[cprotext.API.NONCE_VAR]=K;J=b.param(J);var i=b.ajax({url:cprotext.API.URL+J,dataType:"jsonp",error:function(M,O,N){b(".ui-dialog-buttonpane").removeAttr("disabled").css("visibility","visible");r.html(cprotext.L10N.getFail+":<br/>"+O+"<br/>"+cprotext.L10N.cancellation);r.dialog("option","buttons",[{text:cprotext.L10N.okButton,click:f}])},success:function(M){b(".ui-dialog-buttonpane").removeAttr("disabled").css("visibility","visible");if(M.hasOwnProperty("error")){r.html(cprotext.L10N.getFail+":<br/>"+M.error+"<br/>"+cprotext.L10N.cancellation);r.dialog("option","buttons",[{text:cprotext.L10N.okButton,click:f}])}else{b("#waitforit").removeClass("dary");b("#cptx_contentVer").val(M.version);b("#cptx_contentCSS").val(M.css);b("#cptx_contentHTML").val(M.html);b("#cptx_contentEOTE").val(M.eote);b("#cptx_contentEOTS").val(M.eots);b("#cptx_contentId").val(M.tid);r.html("<p>"+cprotext.L10N.getSuccess1+"</p><p>"+cprotext.L10N.getSuccess2+"</p>");r.dialog("option","buttons",[{text:cprotext.L10N.submitButton,click:function(){f();b("#publish").off("click.cptx");while(H.length>0){b("#publish").on("click",H.shift())}if(!b("#cptx_statusChange").val()){b("#cptx_statusChange").val(0)}var N=b("#cptx_statusChange").val();N^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(N);b("#publish").click()}}])}}})}function l(I,L,M,J){J=typeof J!=="undefined"?J:"status";var K={f:"status",t:I,tid:M,n:J};K[cprotext.API.NONCE_VAR]=L;K=b.param(K);var i=b.ajax({url:cprotext.API.URL+K,dataType:"jsonp",error:function(N,P,O){r.html(cprotext.L10N.submitFail+":<br/>"+P+"<br/>"+cprotext.L10N.cancellation);r.dialog("option","buttons",[{text:cprotext.L10N.okButton,click:f}])},success:function(O){var Q;if(O.hasOwnProperty("error")){Q=cprotext.L10N.statusFail+":<br/>"+O.error+"<br/>"+cprotext.L10N.cancellation;r.html(Q);r.dialog("option","buttons",[{text:cprotext.L10N.okButton,click:f}])}else{var N=cprotext.L10N.statusUnknown;if(O.status===""){N=cprotext.L10N.statusDone}else{switch(O.status[0]){case -1:N=cprotext.L10N.failed+" => ";switch(O.status[1][0]){case 0:N+=cprotext.L10N.statusError0;break;case 1:N+=cprotext.L10N.statusError1;break;case 2:N+=cprotext.L10N.statusError2;break;case 3:N+=O.status[1][4]+" "+cprotext.L10N.statusError3;break;case 4:if(O.status[1][5]==="eot"){N+=cprotext.L10N.statusError41+" "+O.status[1][4]}else{N+=cprotext.L10N.statusError42+" "+O.status[1][4]}break;case 5:if(O.status[1][5]==="eot"){N+=cprotext.L10N.statusError51}else{N+=cprotext.L10N.statusError52}break;case 6:N+=cprotext.L10N.statusError6;break;case 7:N+=cprotext.L10N.statusError7;break}break;case -2:var P={opened:"[",closed:"]"};N=cprotext.L10N.processing+"<br/>"+P.opened+" "+cprotext.L10N.step+" ";switch(O.status[1]){case 1:N+="1/3: "+cprotext.L10N.statusProcess1;break;case 2:N+="2/3: "+cprotext.L10N.statusProcess2;break;case 3:N+="3/3: "+cprotext.L10N.statusProcess3;break}N+=" "+P.closed;break;case 0:N=cprotext.L10N.statusWaiting;break;default:N=cprotext.L10N.statusQueueing+": "+O.status[1][4]+" "+cprotext.L10N.statusRemaining;break}}var R=b(".status");if(!R.length){Q="<p></p><div class='legen dary' id='waitforit'><p class='status'>"+cprotext.L10N.processing+" …</p></div>";r.html(Q);r.dialog("option","buttons",[{text:cprotext.L10N.returnButton,click:function(){f();b("#publish").off("click.cptx");while(H.length>0){b("#publish").on("click",H.shift())}if(b("#cptx_contentId").val().charAt(0)==="W"){window.location=b("#wp-admin-bar-view-site>a")[0].href}else{var S=b("#cptx_statusChange").val();if(!(S&cprotext.STATUS.PUBLISHED)&&(S&cprotext.STATUS.CHANGED)&&(S&cprotext.STATUS.CPROTEXTED)){b("#save-post").click()}else{b("#publish").click()}}}}]);r.dialog("open")}R.html(N)}},complete:function(N,O){if(O!="success"){return}if(N.responseJSON.status!==""){setTimeout(function(){l(N.responseJSON.token,N.responseJSON.wpcptx,M)},2000)}else{switch(J){case"status":l(N.responseJSON.token,N.responseJSON.wpcptx,M,"get");break;case"get":if(N.responseJSON.pwyw){r.html("<p>"+cprotext.L10N.pwyw+"</p>");r.dialog("option","buttons",[{text:"ok",click:function(){f();b("#publish").off("click.cptx");while(H.length>0){b("#publish").on("click",H.shift())}b("#cptx_statusChange").val(0);if(!b("#cptx_contentId").val()||b("#cptx_contentId").val().charAt(0)==="W"){b("#save-post").click()}else{window.location=b("#wp-admin-bar-view-site>a")[0].href}}}])}else{o(N.responseJSON.token,N.responseJSON.wpcptx,M)}break}}}})}function B(J,M,N){N=typeof N!=="undefined"?N:false;var L={t:J,n:"status"};L[cprotext.API.NONCE_VAR]=M;var i={};if(!N){L.f="submit"}else{L.f="update";L.tid=b("#cptx_contentId").val()}var K=b("#cptx_statusChange").val();if(!N||(K&cprotext.STATUS.UPDATE_TITLE)){i.ti=b("#title").val()}if(!N||(K&cprotext.STATUS.UPDATE_CONTENT)){i.c=b("#content").html();if(b("#wp-content-wrap").hasClass("tmce-active")){i.c=tinyMCE.activeEditor.getContent()}else{i.c=b("#content").val()}}if(K&cprotext.STATUS.IE8_ENABLED){L.ie=true}if(!N||(K&cprotext.STATUS.UPDATE_PLH)){i.plh=b("#cptx_plh").val()}if(!N||(K&cprotext.STATUS.UPDATE_FONT)){L.ft=b("#cptx_fontsel").val()}L=b.param(L);var I=b.ajax({cptxFunc:N?"update":"submit",url:cprotext.API.URL+L,type:"POST",data:i,dataType:"jsonp",error:function(O,Q,P){r.html(cprotext.L10N[this.cptxFunc+"Fail"]+":<br/>"+O.responseJSON+"<br/>"+cprotext.L10N.cancellation);r.dialog("option","buttons",[{text:cprotext.L10N.okButton,click:f}])},success:function(O){r.dialog("close");if(O.hasOwnProperty("error")){r.html(cprotext.L10N[this.cptxFunc+"Fail"]+":<br/>"+O.error+"<br/>"+cprotext.L10N.cancellation);r.dialog("option","buttons",[{text:cprotext.L10N.okButton,click:f}]);r.dialog("open")}else{b("#cptx_contentId").val(O.tid);var P=b("#cptx_statusChange").val();if(N&&(P&cprotext.STATUS.WPUPDATES)&&!(P&cprotext.STATUS.UPDATE_CONTENT)&&!(P&cprotext.STATUS.UPDATE_FONT)&&!(P&cprotext.STATUS.UPDATE_PLH)&&!(P&cprotext.STATUS.IE8_ENABLED)){P^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(P);f();b("#publish").off("click.cptx");while(H.length>0){b("#publish").on("click",H.shift())}b("#publish").click()}l(O.token,O.wpcptx,O.tid)}}})}function G(i,J,I,K){r.html("<p>"+cprotext.L10N.credits1+" "+I+" "+cprotext.L10N.credits2+"</p><p>"+cprotext.L10N.credits3.replace("%1",K).replace("%2",(K>1?"s":""))+"<p/><p>"+cprotext.L10N.credits4+"<p/><div class='legen' id='waitforit'><p>"+cprotext.L10N.processing+" …</p></div>");r.dialog("option","buttons",[{text:cprotext.L10N.noButton,click:f},{text:cprotext.L10N.yesButton,click:function(){if(b("#cptx_contentId").val()===""||(b("#cptx_statusChange").val()&cprotext.STATUS.UPDATE_CONTENT)){B(i,J)}else{B(i,J,true)}}}])}function u(I,L){var K={f:"credits",t:I,};K[cprotext.API.NONCE_VAR]=L;var J=b("#cptx_statusChange").val();if(b("#cptx_contentId").val()===""||(J&cprotext.STATUS.UPDATE_CONTENT)){K.n="submit"}else{K.n="update";K.tid=b("#cptx_contentId").val()}if(J&cprotext.STATUS.UPDATE_FONT){K.ft=true}if(J&cprotext.STATUS.IE8_ENABLED){K.ie=true}K=b.param(K);var i=b.ajax({url:cprotext.API.URL,data:K,dataType:"jsonp",error:function(N,P,O){var M=cprotext.L10N.creditsFail+":<br/>"+cprotext.L10N.cancellation;r.html(M);r.dialog("option","buttons",[{text:cprotext.L10N.okButton,click:f}])},success:function(M){r.dialog("close");if(M.hasOwnProperty("error")){r.html(cprotext.L10N.creditsFail);r.dialog("option","buttons",[{text:cprotext.L10N.okButton,click:f}])}else{G(M.token,M.wpcptx,M.credits,M.cost)}r.dialog("open")}})}function e(){var J=b("#cptx_email").val();b("#cptx_email").val("");var I=b("#cptx_password").val();b("#cptx_password").val("");var K={f:"token",e:J,p:I};K[cprotext.API.NONCE_VAR]=cprotext.API.INITIAL_NONCE;if(m.length){if(p==="fontlist"){K.n="fonts"}else{if(p==="fontFile"){K.n="font"}}}else{if(b("#cptx_contentId").val().charAt(0)==="W"){K.n="status"}else{K.n="credits"}}K=b.param(K);var i=b.ajax({url:cprotext.API.URL,data:K,dataType:"jsonp",error:function(L,N,M){r.children("#cptx_msg").html(cprotext.L10N.identifyFail+":<br/>"+N+"/"+M)},success:function(L){if(L.hasOwnProperty("error")){r.children("#cptx_msg").html(cprotext.L10N.identifyFail+":<br/>"+L.error)}else{if(m.length){if(p==="fontlist"){k(L.token,L.wpcptx)}else{if(p==="fontFile"){n(L.token,L.wpcptx)}}}else{if(b("#cptx_contentId").val().charAt(0)=="W"){l(L.token,L.wpcptx,b("#cptx_contentId").val().substr(1))}else{u(L.token,L.wpcptx)}}}}});J=c;I=c}function j(J,i){J=(typeof J==="undefined"||J==="")?"":"<div>"+J+"</div>";i=typeof i!=="undefined"?i:false;var I=J+"<div id='cptx_msg' style='color:'red''></div><div>"+cprotext.L10N.login+":</div><div class='cptx_form'><label>"+cprotext.L10N.email+": <br/><input type='text' id='cptx_email'/></label><br/><label>"+cprotext.L10N.password+": <br/><input type='password' id='cptx_password'/></label></div>";r.html(I);b("#cptx_email,#cptx_password").on("change",function(K){K.stopPropagation()});r.dialog(b.extend({},F,{buttons:[{text:cprotext.L10N.cancelButton,click:function(){b("#cptx_email").val("");b("#cptx_password").val("");t=null;if(i){window.location=b("#wp-admin-bar-view-site>a")[0].href}f()}},{text:cprotext.L10N.identifyButton,click:e}]}))}function D(I){var i="";if(I&cprotext.STATUS.UPDATE_CONTENT){i+="<li> - "+cprotext.L10N.commitUpdateContent+"</li>"}if(I&cprotext.STATUS.UPDATE_TITLE){i+="<li> - "+cprotext.L10N.commitUpdateTitle+"</li>"}if(!q&&(I&cprotext.STATUS.IE8_ENABLED)){i+="<li> - "+cprotext.L10N.commitUpdateIE8+"</li>"}if(I&cprotext.STATUS.UPDATE_FONT){i+="<li> - "+cprotext.L10N.commitUpdateFont+"</li>"}if(I&cprotext.STATUS.UPDATE_PLH){i+="<li> - "+cprotext.L10N.commitUpdatePlh+"</li>"}if(i!==""){b("#cptx_statusChange").val(I);j("<div>"+cprotext.L10N.authenticationRequired+"</div><ul>"+i+"</ul>")}else{I^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(I);b("#publish").off("click.cptx");while(H.length>0){b("#publish").on("click",H.shift())}b("#publish").click()}}function h(K){p=K.target.id;if(m.length){r=b("<div id='cptxDialog'></div>");j()}if(y.length&&(y.prop("checked")||y[0].getAttribute("checked"))){var J=cprotext.STATUS.CPROTEXTED|cprotext.STATUS.PROCESSING;if(b('#post_status>option[selected="selected"]').val()!=="publish"){J|=cprotext.STATUS.NOT_PUBLISHED;if(b("#publish").length&&b("#publish").attr("name")==="publish"){J|=cprotext.STATUS.CHANGED}else{J|=cprotext.STATUS.NOT_CHANGED}}else{J|=cprotext.STATUS.PUBLISHED;if(b("#post_status>option:selected").val()==="publish"){J|=cprotext.STATUS.NOT_CHANGED}else{J|=cprotext.STATUS.CHANGED}}var I="";if(b("#wp-content-wrap").hasClass("tmce-active")){I=tinyMCE.activeEditor.getContent()}else{I=b("#content").val()}if(s!=I){J|=cprotext.STATUS.UPDATE_CONTENT}if(x!==b("#title").val()){J|=cprotext.STATUS.UPDATE_TITLE}if(b("#cptx_ie8").prop("checked")){J|=cprotext.STATUS.IE8_ENABLED}if(q!==b("#cptx_ie8").prop("checked")){J|=cprotext.STATUS.IE8_CHANGED}if(A!==b("#cptx_fontsel").val()){J|=cprotext.STATUS.UPDATE_FONT}if(w!==b("#cptx_plh").val()){J|=cprotext.STATUS.UPDATE_PLH}if(v!==b("#cptx_kw").val()){J|=cprotext.STATUS.UPDATE_KW}if(b("#cptxed").length){cptxed=b("#cptxed").val()}r=b("<div id='cptxDialog'></div>");var i="";switch(J&(cprotext.STATUS.PUBLISHED|cprotext.STATUS.CHANGED)){case (cprotext.STATUS.NOT_PUBLISHED|cprotext.STATUS.NOT_CHANGED):r.html("<div>"+cprotext.L10N.bugReportRequired+"</div>");r.dialog(b.extend({},F,{buttons:[{text:cprotext.L10N.closeButton,click:f}]}));break;case (cprotext.STATUS.NOT_PUBLISHED|cprotext.STATUS.CHANGED):if(!cptxed){b("#cptx_statusChange").val(J);j()}else{D(J)}break;case (cprotext.STATUS.PUBLISHED|cprotext.STATUS.NOT_CHANGED):if(y[0].getAttribute("checked")==="checked"){if(y.prop("checked")){D(J)}else{J^=cprotext.STATUS.CPROTEXTED;J^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(J);b("#publish").off("click.cptx");while(H.length>0){b("#publish").on("click",H.shift())}b("#publish").click()}}else{if(y.prop("checked")){if(!cptxed){b("#cptx_statusChange").val(J);j()}else{D(J)}}else{J^=cprotext.STATUS.CPROTEXTED;J^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(J);r.html("<div>"+cprotext.L10N.bugReportRequired+"</div>");r.dialog(b.extend({},F,{buttons:[{text:cprotext.L10N.closeButton,click:f}]}))}}break;case (cprotext.STATUS.PUBLISHED|cprotext.STATUS.CHANGED):if(y[0].getAttribute("checked")==="checked"){if(y.prop("checked")){i="<div>"+cprotext.L10N.unpublished;if(J&cprotext.STATUS.WPUPDATES){i+=cprotext.L10N.detachedFromRevision}else{i+=cprotext.L10N.attachedToRevision}i+="</div>";r.html(i);r.dialog(b.extend({},F,{buttons:[{text:cprotext.L10N.closeButton,click:function(){f();b("#cptx_statusChange").val(J);b("#publish").off("click.cptx");while(H.length>0){b("#publish").on("click",H.shift())}b("#publish").click()}}]}))}else{J^=cprotext.STATUS.CPROTEXTED;J^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(J);b("#publish").off("click.cptx");while(H.length>0){b("#publish").on("click",H.shift())}b("#publish").click()}}else{if(y.prop("checked")){i="<div>"+cprotext.L10N.uselessProtection+"</div>";r.html(i);r.dialog(b.extend({},F,{buttons:[{text:cprotext.L10N.closeButton,click:function(){f();J^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(J);b("#publish").off("click.cptx");while(H.length>0){b("#publish").on("click",H.shift())}b("#publish").click()}}]}))}else{J^=cprotext.STATUS.CPROTEXTED;J^=cprotext.STATUS.PROCESSING;b("#cptx_statusChange").val(J);i="<div>"+cprotext.L10N.bugReportRequired+"</div>";r.html(i);r.dialog(b.extend({},F,{buttons:[{text:cprotext.L10N.closeButton,click:f}]}))}}break}}if(r!==""){r.dialog("open");K.stopImmediatePropagation();return false}}if(y.length||m.length){b("#cptx_check").on("click",function(){if(b(this).attr("checked")==="checked"){b("#cptx_ie8").removeAttr("disabled");b("#cptx_fontsel, #cptx_fontsel option").removeAttr("disabled");b("#cptx_kw").removeAttr("disabled");b("#cptx_plh").removeAttr("disabled");q=b("#cptx_ie8").prop("checked");A=b("#cptx_fontsel").val();w=b("#cptx_plh").val();v=b("#cptx_kw").val()}else{b("#cptx_ie8").attr("disabled","disabled");b("#cptx_fontsel, #cptx_fontsel option").attr("disabled","disabled");b("#cptx_kw").attr("disabled","disabled");b("#cptx_plh").attr("disabled","disabled")}});if(y.length&&b("#cptx_contentId").val().charAt(0)==="W"){r=b("<div id='cptxDialog'></div>");j("<p>"+cprotext.L10N.resume+"</p>",true);r.dialog("open")}if(b("#publish").length){var g=b._data(b("#publish")[0],"events");for(var C=0,E=g.click.length;C<E;C++){H.push(g.click[C].handler)}b("#publish").off("click")}else{b("#cptx_optionform").on("change","input,select",z)}b("#publish, #fontlist").on("click.cptx",h);b("#fontFile").on("change.cptx",h)}if(y.length){x=b("#title").val();if(b("#wp-content-wrap").hasClass("tmce-active")){s=tinyMCE.activeEditor.getContent()}else{s=b("#content").val()}q=b("#cptx_ie8").prop("checked");A=b("#cptx_fontsel").val();w=b("#cptx_plh").val();v=b("#cptx_kw").val()}};var a=window.onload;if(typeof window.onload!=="function"){window.onload=d}else{window.onload=function(){if(a){a()}d()}}}(jQuery));